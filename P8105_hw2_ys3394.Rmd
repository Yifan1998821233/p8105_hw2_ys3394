---
title: "P8105_hw2_ys3394"
author: "Yifan Su"
date: "9/30/2020"
output: github_document
---

```{r include=FALSE}
library(tidyverse)
library(readxl)
```

## Problem 1

#### Read and clean the Mr. Trach Wheel dataset.

```{r}
trash_df =
  read_xlsx(
    "./data2/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
    sheet = "Mr. Trash Wheel",
    range = cell_cols("A:N")) %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(
    sport_balls = round(sports_balls),
    sport_balls = as.integer(sports_balls)
  ) %>% 
  relocate(dumpster, year, month, everything())
head(trash_df)
```

#### Read and clean precipitation data for 2017 and 2018.

```{r pre_2017&2018, message = FALSE}
pre_2018 = 
  read_xlsx(
    "./data2/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
    sheet = "2018 Precipitation",
    skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(month) %>% 
  mutate(year = 2018) %>% 
  relocate(year)

pre_2017 = 
  read_xlsx(
    "./data2/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
    sheet = "2017 Precipitation",
    skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(month) %>% 
  mutate(year = 2017) %>% 
  relocate(year)
```

Then, combine two precipitation datasets.

```{r pre_df, message = FALSE}
month_df =
  tibble(
    month = 1:12,
    month_name = month.name)

pre_df =
  bind_rows(pre_2018, pre_2017) %>%
  left_join(month_df, by = "month")
str(pre_df)
```

```{r include = FALSE}
trash_dfm = 
  filter(trash_df, year == "2017")
```

Mr.Trash Wheel is a vessel removes trash in Baltimore, Maryland since 2014. The dataset is about the information stored in the dumpster, including month, year, volumes and types of trash. For the data of precipitation in 2018, there are `r nrow(pre_2018)` rows, and the total precipitation in 2018 is `r sum(pull(pre_2018, total))`. The median number of sports balls in the dumpster in 2017 is `r median(pull(trash_dfm, sports_balls))`.


## Problem 2

#### Read and clean the NYC Transit dataset.

```{r message=FALSE}
rm(list = ls())

NYC_df = 
  read_csv(
    "./data2/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>%   
  janitor::clean_names() %>% 
  select(line:entry, vending, ada) %>% 
  mutate(entry = if_else(entry == "YES", 1, 0))
head(NYC_df)
```

In the NYC transit dataset, there are variables include station name, route numbers, and entrance type, etc. By now, I've read the csv file, select required columns, and converted the entry variable from the character variable to the ligical variable. The number of rows of the dataset is `r NYC_df %>% nrow()`. The dataset is not yet tidy, there are variables such as those routes, can be combined together.

* There are `r nrow(distinct(NYC_df, line, station_name))` distinct stations in the dataset.

* There `r nrow(filter(NYC_df, ada == "TRUE"))` stations that are ADA compliant. 

* The proportion of station entrances and exits without vending is `r nrow(filter(NYC_df, vending == "NO")) / nrow(NYC_df)`.

#### Reformate data, make route number and route name distinct variables.

```{r message=FALSE}
NYC_tidy = 
  NYC_df %>% 
  mutate(
    route8 = as.character(route8),
    route9 = as.character(route9),
    route10 = as.character(route10),
    route11 = as.character(route11)
  ) %>% 
  pivot_longer(
    route1:route11,
    names_to = "route_name",
    values_to = "route_num"
  ) %>% 
  drop_na(route_num)
head(NYC_tidy)
```

There are `r NYC_tidy %>% filter(route_num == "A") %>% distinct(station_name, line) %>% count()` distinct stations that serve the A train. 

Among thee stations, there are `r NYC_tidy %>% filter(route_num == "A") %>% distinct(station_name, line, ada) %>% filter(ada == "TRUE") %>% count()` stations that are ADA compliant.


## Problem 3

Clean the data in pols_month. csv.

```{r warning=FALSE, message=FALSE}
rm(list = ls())

month_df =
  tibble(
    month = 1:12,
    month_name = month.name)

pols_df = 
  read_csv(
    "./data2/pols-month.csv") %>%   
  janitor::clean_names() %>% 
  separate(mon, into = c("year", "month", "day"), "-") %>% 
  mutate(month = as.integer(month)) %>% 
  left_join(month_df, by = "month") %>% 
  select(-month, -day) %>% 
  pivot_longer(
    cols = starts_with("prez_"),
    names_to = "president",
    values_to = "president_val",
    names_prefix = "prez_"
  ) %>% 
  relocate(year, month_name, everything())
str(pols_df)
```

Clean the data in snp.csv using the similar process.

```{r warning=FALSE, message=FALSE}
snp_df = 
  read_csv(
    "./data2/snp.csv") %>%   
  janitor::clean_names() %>% 
  separate(date, into = c("month", "day", "year"), "/") %>% 
  mutate(month = as.integer(month)) %>% 
  left_join(month_df, by = "month") %>% 
  select(-month) %>% 
  relocate(year, month_name, everything())
str(snp_df)
```

Tidy the unemployment.csv dataset.

```{r warning=FALSE, message=FALSE}
month_df2 =
  tibble(
    month = c("jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec"),
    month_name = month.name
  )

unemployment_df = 
  read_csv(
    "./data2/unemployment.csv") %>%   
  janitor::clean_names() %>% 
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "unemployment_rate"
  ) %>% 
  mutate(year = as.character(year)) %>% 
  left_join(month_df2, by = "month") %>% 
  select(-month) %>% 
  relocate(year, month_name, everything())
str(unemployment_df)
```

Join three datasets by year and month.

```{r}
comb_df = 
  left_join(pols_df, snp_df, by = c("year", "month_name")) %>% 
  left_join(unemployment_df, by = c("year", "month_name")) %>% 
 relocate(year, month_name, everything())
head(comb_df)
```

In the combined dataset, there are some key variables such as year, president and unemployment rate. The combined dataset has `r nrow(comb_df)` rows, with `r ncol(comb_df)` columns. The range of the dataset is `r distinct(comb_df, year) %>% count()` years. 




